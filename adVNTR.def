Bootstrap: docker
From: ubuntu:latest

%post
    echo "Downloading apps and supporting dependencies"
    apt-get update
    apt install -y openjdk-8-jdk openjdk-8-jre
    apt-get -y install curl 
    apt install wget
    apt-get -y  install git
    apt install make
    apt-get -y  install g++
    apt install unzip
    apt -y  install python2
    apt-get -y install python-dev 
    apt-get -y install -y libbz2-dev
    apt-get -y install liblzma-dev
    curl https://bootstrap.pypa.io/pip/2.7/get-pip.py --output get-pip.py
    python2 get-pip.py
    pip install Cython
    echo 'tzdata tzdata/Areas select Europe' | debconf-set-selections
    echo 'tzdata tzdata/Zones/Europe select Paris' | debconf-set-selections
    DEBIAN_FRONTEND="noninteractive" apt-get -y  install python-tk
    apt-get -y install libz-dev 
    apt-get -y install samtools
    apt-get install muscle 
    pip install setuptools
    pip install matplotlib
    pip install biopython==1.76
    pip install pysam>=0.9.1.4
    pip install cython
    pip install networkx==1.11
    pip install scipy
    pip install joblib
    pip install scikit-learn
    git clone https://github.com/mehrdadbakhtiari/adVNTR.git --branch enhanced_hmm
    cd adVNTR
    make; make install
    python setup.py install
    cd ~
    apt-get install bwa
    # Installing GATK
    wget https://services.gradle.org/distributions/gradle-7.4.2-bin.zip
    mkdir /opt/gradle
    unzip -d /opt/gradle gradle-7.4.2-bin.zip
    ls /opt/gradle/gradle-7.4.2
    export PATH=$PATH:/opt/gradle/gradle-7.4.2/bin
    curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | bash
    wget https://github.com/git-lfs/git-lfs/releases/download/v3.1.2/git-lfs-linux-amd64-v3.1.2.tar.gz
    tar -xf git-lfs-linux-amd64-v3.1.2.tar.gz
    chmod 755 install.sh
    ./install.sh
    git clone https://github.com/broadinstitute/gatk.git
    cd gatk
    ./gradlew bundle
    rm gradle-7.4.2-bin.zip 
    
    cd ~
    wget https://github.com/broadinstitute/picard/releases/download/2.26.11/picard.jar
    wget http://www.usadellab.org/cms/uploads/supplementary/Trimmomatic/Trimmomatic-0.39.zip
    unzip Trimmomatic-0.39.zip
    wget https://snpeff.blob.core.windows.net/versions/snpEff_latest_core.zip
    unzip snpEff_latest_core.zip
    cd ~
    rm snpEff_latest_core.zip
    rm Trimmomatic-0.39.zip
    apt-get install -y fastqc
   
%labels
    Author hassan.saei@inserm.fr
    Version v1.0.0
    adVNTR


%runscript
        echo "Container was created $NOW"
        echo "Arguments received: $*"
        exec echo "$@"


%help
    This is a container for genotyping MUC1-VNTR.
